---
import BaseLayout from '../layouts/BaseLayout.astro';
import { sanityClient, type Profile } from '../lib/sanityClient';

const profile = await sanityClient.fetch<Profile>(
  `*[_type == "profile" && _id == "profile"][0] {
    _id,
    email,
    instagramHandle,
    location
  }`
);
---

<BaseLayout title="Contact - Yufang Zhang Ceramics" description="Commission inquiries and sales">
  <main class="min-h-screen px-8 py-24" style="background-color: var(--color-bg); color: var(--color-text-main);">
    <div class="max-w-2xl mx-auto text-center">

      <!-- Header -->
      <header class="mb-20">
        <h1 class="text-[11px] uppercase tracking-museum mb-8" style="color: var(--color-text-muted);">
          Acquisitions & Inquiries
        </h1>
        <div class="max-w-lg mx-auto">
          <p class="text-sm font-light leading-relaxed tracking-wide" style="color: var(--color-text-main); opacity: 0.8;">
            For inquiries regarding pieces shown in Selected Works, please include the name of the work in your message. To stay updated on new releases or to inquire about available work, please use the form below or send a DM on Instagram.
          </p>
        </div>
      </header>

      <!-- Contact Form -->
      <form
        id="contact-form"
        action={profile?.email ? `https://formspree.io/f/YOUR_FORMSPREE_ID` : '#'}
        method="POST"
        class="space-y-12 text-left"
      >
        <!-- Name Field -->
        <div class="relative">
          <label for="name" class="text-[9px] uppercase tracking-widest mb-1 block" style="color: var(--color-text-muted);">
            Name <span class="text-red-400">*</span>
          </label>
          <input
            type="text"
            id="name"
            name="name"
            class="w-full bg-transparent border-b py-3 outline-none transition-colors font-light"
            style="border-color: var(--color-line); color: var(--color-text-main);"
            onfocus="this.style.borderColor='var(--color-text-main)';"
            onblur="this.style.borderColor='var(--color-line)';"
            placeholder="Your name"
            required
          />
        </div>

        <!-- Email Field -->
        <div class="relative">
          <label for="email" class="text-[9px] uppercase tracking-widest mb-1 block" style="color: var(--color-text-muted);">
            Email <span class="text-red-400">*</span>
          </label>
          <input
            type="email"
            id="email"
            name="email"
            class="w-full bg-transparent border-b py-3 outline-none transition-colors font-light"
            style="border-color: var(--color-line); color: var(--color-text-main);"
            onfocus="this.style.borderColor='var(--color-text-main)';"
            onblur="this.style.borderColor='var(--color-line)';"
            placeholder="Email address"
            required
          />
        </div>

        <!-- Inquiry Type -->
        <div class="relative">
          <label for="inquiry-type" class="text-[9px] uppercase tracking-widest mb-1 block" style="color: var(--color-text-muted);">
            Inquiry Type <span class="text-red-400">*</span>
          </label>
          <select
            id="inquiry-type"
            name="inquiry-type"
            class="w-full bg-transparent border-b py-3 outline-none transition-colors font-light appearance-none cursor-pointer"
            style="border-color: var(--color-line); color: var(--color-text-main);"
            onfocus="this.style.borderColor='var(--color-text-main)';"
            onblur="this.style.borderColor='var(--color-line)';"
            required
          >
            <option value="">Select...</option>
            <option value="commission">Bespoke Commission</option>
            <option value="purchase">Available Work in Gallery</option>
            <option value="general">General Inquiry</option>
            <option value="other">Other</option>
          </select>
        </div>

        <!-- Message Field -->
        <div class="relative">
          <label for="message" class="text-[9px] uppercase tracking-widest mb-1 block" style="color: var(--color-text-muted);">
            Message <span class="text-red-400">*</span>
          </label>
          <textarea
            id="message"
            name="message"
            rows="4"
            class="w-full bg-transparent border-b py-3 outline-none transition-colors font-light resize-none"
            style="border-color: var(--color-line); color: var(--color-text-main);"
            onfocus="this.style.borderColor='var(--color-text-main)';"
            onblur="this.style.borderColor='var(--color-line)';"
            placeholder="How can I help you?"
            required
          ></textarea>
        </div>

        <!-- Submit Button -->
        <div class="flex justify-center pt-10">
          <button
            id="submit-button"
            type="submit"
            class="btn-zen disabled:opacity-50 disabled:cursor-not-allowed active:scale-95"
          >
            <span id="button-text">Send Message</span>
          </button>
        </div>
      </form>

      <!-- Social Footer -->
      <div class="mt-24 pt-12" style="border-top: 1px solid var(--color-line);">
        {profile?.instagramHandle ? (
          <a
            href={`https://instagram.com/${profile.instagramHandle}`}
            target="_blank"
            rel="noopener noreferrer"
            class="group inline-flex flex-col items-center"
          >
            <span class="text-[9px] uppercase tracking-editorial mb-2" style="color: var(--color-text-muted);">
              Social
            </span>
            <span class="inline-flex items-center gap-2 text-sm font-medium tracking-wide group-hover:opacity-70 transition-opacity underline underline-offset-8" style="color: var(--color-text-main); text-decoration-color: var(--color-line);">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24" style="color: var(--color-text-muted);">
                <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
              </svg>
              @{profile.instagramHandle}
            </span>
          </a>
        ) : (
          <div class="text-[9px] uppercase tracking-editorial" style="color: var(--color-text-muted);">
            Follow the Studio
          </div>
        )}
      </div>

      <!-- Alternative: Direct Email Link -->
      {profile?.email && (
        <div class="mt-8">
          <p class="text-[9px] uppercase tracking-widest mb-2" style="color: var(--color-text-muted);">
            Or Email Directly
          </p>
          <a
            href={`mailto:${profile.email}`}
            class="text-sm font-light transition-opacity hover:opacity-70"
            style="color: var(--color-text-main);"
          >
            {profile.email}
          </a>
        </div>
      )}
    </div>
  </main>
</BaseLayout>

<style>
  /* Ensure form inputs and textareas have consistent styling */
  input::placeholder,
  textarea::placeholder {
    color: #a1a1aa;
    opacity: 0.5;
  }

  select {
    cursor: pointer;
    color: #27272A;
  }

  /* Style for default select option */
  select option[value=""] {
    color: #a1a1aa;
  }

  select option {
    background: #F5F2ED;
    color: #27272A;
  }

  /* Remove default select arrow styling */
  select {
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%2327272A' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 0.5rem center;
    padding-right: 2rem;
  }
</style>

<script>
  // Handle form submission state
  const form = document.getElementById('contact-form');
  const submitButton = document.getElementById('submit-button');
  const buttonText = document.getElementById('button-text');

  if (form && submitButton && buttonText) {
    form.addEventListener('submit', function() {
      // Change button text and disable it
      buttonText.textContent = 'Sending...';
      submitButton.disabled = true;

      // Optional: Add a subtle loading indicator
      submitButton.classList.add('opacity-75');
    });
  }
</script>
